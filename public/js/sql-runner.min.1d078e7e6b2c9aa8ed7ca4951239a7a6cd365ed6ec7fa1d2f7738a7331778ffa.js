(function(){const l="Run SQL",f="Loading…",h="Running…",v="Result",c=!0,_=!0,t=700,r="(no rows)",u="(db initialized)",p=[".admonition.code code.language-sql","div.highlight div.chroma table code.language-sql","div.highlight div.chroma pre code.language-sql"].join(",");let d=null,e="idle";function o(){return`<span class="pm-run-spinner" aria-hidden="true"></span>`}function m(){return`<svg class="admon-icon" xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 640 512" width="16" height="16" fill="currentColor" aria-hidden="true">
        <path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6zm80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3L562.7 256l-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3z"></path>
        </svg>`}function n(){return e="loading",d=(async()=>{if(!window.initSqlJs){const e=document.createElement("script");e.src="https://sql.js.org/dist/sql-wasm.js",document.head.appendChild(e),await new Promise(t=>e.onload=t)}const e=await initSqlJs({locateFile:e=>`https://sql.js.org/dist/${e}`});return new e.Database})().then(t=>(e="ready",t)).catch(t=>{throw e="idle",console.error("[sql-runner] load failed",t),alert("SQL engine load failed: "+t),t}),d}function s(e){return e.closest(".admonition.code")}function g(e){const n=s(e);if(!n)return a(e.closest(".highlight")||e.parentElement,null);const t=n.nextElementSibling;return t&&t.classList.contains("admonition")&&t.classList.contains("code")&&t.classList.contains("sql-run-result")?t:a(n,n)}function a(e,t){const n=document.createElement("div");n.className="admonition code sql-run-result";let s="";if(t){const e=t.querySelector(".admonition-header svg");e&&(s=e.outerHTML)}s||(s=m());const o=document.createElement("div");o.className="admonition-header",o.innerHTML=`${s}<span>${v}</span>`;const i=document.createElement("div");i.className="admonition-content";const a=document.createElement("pre");return a.className="sql-run-stdout",i.appendChild(a),n.appendChild(o),n.appendChild(i),e.insertAdjacentElement("afterend",n),n}function b(e){return e.length?e.map(e=>{const t=e.columns.join("	"),n=e.values.map(e=>e.join("	")).join(`
`);return t+`
`+n}).join(`

`):r}function j(e){const t=e.textContent.trim().split(`
`);if(!t.length||t.length<1||t[0].indexOf("	")===-1)return;const n=document.createElement("table");n.className="sql-run-table";const s=n.insertRow();t[0].split("	").forEach(e=>{const t=document.createElement("th");t.textContent=e,s.appendChild(t)}),t.slice(1).forEach(e=>{const t=n.insertRow();e.split("	").forEach(e=>{const n=document.createElement("td");n.textContent=e,t.appendChild(n)})}),e.parentNode.replaceChild(n,e)}function y(i){if(i.dataset.sqlRunnerAttached==="1")return;i.dataset.sqlRunnerAttached="1";const v=s(i),m=_&&v?v.querySelector(".admonition-header"):null,p=i.closest(".highlight"),a=document.createElement("button");a.className="pm-run-btn sql-run-btn",a.type="button",a.dataset.state="idle",a.innerHTML=l;function d(e){switch(a.dataset.state=e,e){case"idle":case"done":case"error":a.disabled=!1,a.innerHTML=l;break;case"loading":a.disabled=!0,a.innerHTML=(c?o():"")+f;break;case"running":a.disabled=!0,a.innerHTML=(c?o():"")+h;break}}if(a.addEventListener("click",async()=>{const o=i.innerText,a=g(i);let s=a.querySelector("pre.sql-run-stdout"),c=!1;if(e==="idle"){d("loading");try{await n()}catch{d("error");return}}else e==="loading"&&(d("loading"),await n().catch(()=>{d("error")}));if(e!=="ready"){s.textContent="DB not ready";return}d("running");const l=await n();try{const n=o.split(/;[\r\n]+/).map(e=>e.trim()).filter(Boolean);let e=null;if(!n.length){s.textContent=r,d("done"),setTimeout(()=>d("idle"),t);return}for(const o of n)try{e=l.exec(o)}catch(e){s.textContent="SQL Error: "+e,d("error"),setTimeout(()=>d("idle"),t);return}!e||!e.length?s.textContent=u:(s.textContent=b(e),j(s),c=!0),d("done")}catch(e){s.textContent="Runtime Error: "+e,d("error")}finally{setTimeout(()=>d("idle"),t)}}),m){const e=m.querySelector("span");e?e.insertAdjacentElement("afterend",a):m.appendChild(a)}else if(p){const e=p.querySelector("button.copy-code");e?e.insertAdjacentElement("beforebegin",a):p.insertAdjacentElement("afterend",a)}else i.parentElement.insertAdjacentElement("afterend",a)}function i(){document.querySelectorAll(p).forEach(y)}window.addEventListener("load",i),new MutationObserver(e=>{e.some(e=>e.addedNodes&&e.addedNodes.length)&&i()}).observe(document.documentElement,{childList:!0,subtree:!0})})()